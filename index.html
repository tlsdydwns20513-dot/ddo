<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구구단 산성비 게임</title>
    <style>
        /* CSS: 게임 스타일링 */
        body {
            font-family: 'Malgun Gothic', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #game-wrapper {
            text-align: center;
        }
        #game-container {
            width: 500px;
            height: 600px;
            border: 2px solid #333;
            background-color: #001f3f; /* 어두운 남색 배경 */
            position: relative;
            overflow: hidden; /* 게임 영역 밖으로 나가는 문제 숨기기 */
        }
        .problem {
            position: absolute;
            color: #7FDBFF; /* 밝은 하늘색 글씨 */
            font-size: 24px;
            font-weight: bold;
            white-space: nowrap; /* 문제가 줄바꿈되지 않도록 설정 */
        }
        #score-board {
            font-size: 20px;
            margin-bottom: 10px;
        }
        #answer-input {
            width: 200px;
            padding: 10px;
            font-size: 18px;
            margin-top: 10px;
        }
        #start-button {
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
        }
        #game-over {
            display: none; /* 처음에는 보이지 않음 */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #FF4136; /* 빨간색 */
            font-size: 48px;
            font-weight: bold;
            text-shadow: 2px 2px 4px #000;
        }
    </style>
</head>
<body>

    <div id="game-wrapper">
        <h1>구구단 산성비</h1>
        <div id="score-board">점수: 0 | 남은 생명: 5</div>
        <div id="game-container">
            <div id="game-over">게임 오버</div>
        </div>
        <input type="text" id="answer-input" placeholder="정답을 입력하세요" disabled>
        <button id="start-button">게임 시작</button>
    </div>

    <script>
        // JavaScript: 게임 로직
        const gameContainer = document.getElementById('game-container');
        const scoreBoard = document.getElementById('score-board');
        const answerInput = document.getElementById('answer-input');
        const startButton = document.getElementById('start-button');
        const gameOverText = document.getElementById('game-over');

        let score = 0;
        let lives = 5;
        let problems = []; // 화면에 보이는 문제들을 저장하는 배열
        let gameInterval;
        let problemInterval;

        // 게임 시작 함수
        function startGame() {
            score = 0;
            lives = 5;
            problems = [];
            updateScoreBoard();
            answerInput.disabled = false;
            answerInput.focus();
            startButton.style.display = 'none';
            gameOverText.style.display = 'none';
            gameContainer.innerHTML = ''; // 기존 문제들 초기화
            gameContainer.appendChild(gameOverText);

            // 0.05초마다 게임 상태를 업데이트 (문제 하강)
            gameInterval = setInterval(updateGame, 50);
            // 2초마다 새로운 문제를 생성
            problemInterval = setInterval(createProblem, 2000);
        }

        // 구구단 문제 생성 함수
        function createProblem() {
            const num1 = Math.floor(Math.random() * 8) + 2; // 2~9
            const num2 = Math.floor(Math.random() * 9) + 1; // 1~9
            const answer = num1 * num2;
            const text = `${num1} × ${num2}`;

            const problemElement = document.createElement('div');
            problemElement.className = 'problem';
            problemElement.textContent = text;
            problemElement.style.top = '0px';
            // 게임 컨테이너 너비 안에서 랜덤한 위치에 생성 (글자 너비 고려)
            problemElement.style.left = `${Math.random() * (gameContainer.clientWidth - 100)}px`;

            // 문제 객체에 요소와 정답 정보를 함께 저장
            const problemObject = {
                element: problemElement,
                answer: answer
            };

            problems.push(problemObject);
            gameContainer.appendChild(problemElement);
        }

        // 게임 상태 업데이트 (애니메이션 루프)
        function updateGame() {
            for (let i = problems.length - 1; i >= 0; i--) {
                const problem = problems[i];
                let top = parseInt(problem.element.style.top);
                top += 2; // 떨어지는 속도 조절
                problem.element.style.top = `${top}px`;

                // 문제가 바닥에 닿았을 때
                if (top > gameContainer.clientHeight) {
                    gameContainer.removeChild(problem.element);
                    problems.splice(i, 1);
                    lives--;
                    updateScoreBoard();
                    checkGameOver();
                }
            }
        }
        
        // 정답 확인 함수
        function checkAnswer(event) {
            if (event.key === 'Enter') {
                const userAnswer = parseInt(answerInput.value);
                let isCorrect = false;

                for (let i = problems.length - 1; i >= 0; i--) {
                    if (problems[i].answer === userAnswer) {
                        gameContainer.removeChild(problems[i].element);
                        problems.splice(i, 1);
                        score += 10;
                        updateScoreBoard();
                        isCorrect = true;
                        break; // 정답을 맞춘 첫 번째 문제만 제거
                    }
                }
                answerInput.value = ''; // 입력창 비우기
            }
        }
        
        // 점수판 업데이트
        function updateScoreBoard() {
            scoreBoard.textContent = `점수: ${score} | 남은 생명: ${lives}`;
        }
        
        // 게임 오버 확인
        function checkGameOver() {
            if (lives <= 0) {
                clearInterval(gameInterval);
                clearInterval(problemInterval);
                answerInput.disabled = true;
                gameOverText.style.display = 'block';
                startButton.style.display = 'block';
                startButton.textContent = '다시 시작';
            }
        }

        // 이벤트 리스너 연결
        startButton.addEventListener('click', startGame);
        answerInput.addEventListener('keydown', checkAnswer);

    </script>
</body>
</html>